<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
        integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
  <script src="https://code.jquery.com/jquery-3.7.0.js"
          integrity="sha256-JlqSTELeR4TLqP0OG9dxM7yDPqX1ox/HfgiSLBj8+kM=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <title>Quản Lý Người Dùng - Admin</title>
</head>

<style>
  * {
    margin: 0px;
    padding: 0px;
  }

  hr {
    margin-left: auto;
    margin-right: auto;
    width: 90%;
    border-width: 1px;
  }

  a{
    text-decoration: none !important;
  }

  .subject {
    text-align: center;
    text-transform: uppercase;
  }

  .left {
    background-color: white;
    border: 1px solid;
    width: 70%;
    height: 100%;
    margin-bottom: 20px;
  }

  .right {
    /* background-color: white; */
    /* border: 1px solid; */
    width: 28%;
    height: 100%;
  }

  .bg-white{
    background-color: white;
  }

  .right-no-border {
    width: 28%;
    height: 100%;
  }

  .content {
    display: flex;
    justify-content: space-evenly;
    flex-wrap: wrap;
  }


  .flex {
    display: flex;
    align-items: center;
  }

  .header {
    justify-content: space-between;
  }


  .rightheader div {
    padding: 10px;
  }

  .webicon {
    width: 11%;
    padding: 10px;
  }

  .container {
    width: 80%;
    align-items: center;
    margin: 0 auto;
  }
  .filter-item button {
    padding: 10px 20px;
    background-color: #003c9d; /* Màu nền xanh dương đậm */
    color: white;
    border: none;
    border-radius: 8px; /* Bo góc */
    font-size: 16px;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }

  .filter-item button:hover {
    background-color: #002e7a; /* Màu nền khi hover */
  }

  body {
    justify-content: center;
    position: relative;
    align-items: center;


  }
  .title {
    font-family: 'Montserrat', sans-serif; /* Sử dụng font Montserrat */
    font-size: 36px; /* Kích thước chữ */
    color: #020101; /* Màu chữ trắng */
    text-align: center; /* Căn giữa */
    margin: 20px 0; /* Khoảng cách trên và dưới */
    text-transform: uppercase; /* Chữ in hoa */
    letter-spacing: 2px; /* Khoảng cách giữa các chữ */
    font-weight: bold; /* Chữ đậm */
    padding: 20px; /* Khoảng cách bên trong */
    background: blue;
    border-radius: 10px; /* Bo tròn góc */

  }




  .border {
    border: 0.5px solid gray;
    border-radius: 7px;
  }

  .bordertop {
    border-top: 0;
    border: 0.5px solid gray;
    border-radius: 7px 7px 0 0;
  }

  .borderbottom {
    border: 0.5px solid gray;
    border-radius: 0 0 7px 7px;
  }

  nav {
    width: 100vw;
    background-color: #1266dd;
  }




  nav ul.menu {
    display: flex;
    overflow: hidden;
    list-style-type: none;
    padding: 0;
    margin: 0;
    float: left;


  }

  nav ul.menu>li>a {

    display: block;
    color: white;
    text-align: center;
    padding: 14px 16px;
    text-decoration: none;
    font-size: 17px;
  }

  nav ul.menu>li:hover a {
    border-bottom: 5px solid lightblue;
    transition: all 0.1s;
  }

  nav ul.menu>li>a.active {
    border-bottom: 5px solid lightblue;
  }

  @media screen and (max-width: 873px) {
    .menu {
      flex-direction: column;
    }

    .container{
      width: 95%;
    }

    .content {
      display: block;
    }

    .right {
      width: 100%;
    }

    .left {
      width: 100%;
    }

    .toggle {
      display: block !important;
    }

    nav {
      display: none;
    }

    div.big-device {
      display: none;
    }

    div.small-device {
      display: flex !important;
    }
  }


  div.small-device {
    display: none;
  }

  .toggle {
    display: none;
    background-color: #0f305f;
    color: white;
    text-align: right;
    padding: 10px;
    font-size: 20px;
    cursor: pointer;
  }

  .sticky {
    position: fixed;
    top: 0;
    width: 100%;
  }

  .smaller {
    padding: 8px 16px !important;
  }

  @keyframes move {
    from {
      left: 0;
    }

    to {
      left: 100%;
    }
  }

  .v-menu {
    flex-direction: column;
    overflow: hidden;
    list-style-type: none;
    padding: 0;
    margin: 0;

  }

  .v-menu>li {
    width: 90%;
    border-top: 1px solid lightgray;
  }

  .v-menu>li>a {
    float: left;
    display: block;
    color: black;
    text-align: center;
    padding: 14px 16px;
    text-decoration: none;
    font-size: 17px;
  }

  .v-menu>li>a:hover {
    color: red;
  }

  footer {
    margin-top: 10px;
    overflow: hidden;
    background-color: white;
    padding: 0.5rem;
    color: black;
  }

  footer>span.moving {
    position: relative;
    animation: move 10s infinite;
  }


  .image>img {
    border-radius: 7px;
  }

  .info>div {
    padding: 10px;
  }
  input[type="text"],
  input[type="email"],
  textarea {
    outline: none;
    padding: 5px 0;
    width: 100%;
  }

  .comment-info table {
    /* background-color: #f3f3f3; */
    padding: 20px 30px 15px;
    width: 100%;
  }

  .comment-info table th {
    font-weight: 600;
    padding-bottom: 20px;
    text-align: left;
    text-transform: uppercase;
    width: 25%;
  }

  .comment-info table td {
    padding-bottom: 20px;
  }

  .comment-info p {
    text-align: center;
  }

  .comment-info p button {
    background-color: #666;
    border: none;
    border-radius: 4px;
    color: #fff;
    height: 36px;
    text-align: center;
    width: 100px;
  }

  @media only screen and (max-width: 873px) {
    .comment-info {
      max-width: 90%;
      width: auto;
    }

    .comment-info table th,
    .comment-info table td {
      display: block;
    }

    .comment-info p button {
      width: 50%;
      min-width: 200px;
    }
  }

  .user-img {
    margin-top: 10px;
  }

  .ml-10{
    margin-left: 10px;
  }

  .rounded-circle {
    border-radius: 100px;
  }

  .mt-10 {
    margin-top: 10px;
  }

  .header-btn {
    color: white;
    text-decoration: none;
    background-color: #1266dd;
  }


  .price{
    color: green;
    font-size: 25px;
  }

  .mr-5{
    margin-right: 5px;
  }

  .test{
    background-color: red;
  }

  .wrap-login-btn {
    width: 100%;
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    padding-top: 5px;
    padding-bottom: 10px;
  }

  .login-btn {
    font-family: Montserrat-Bold;
    font-size: 15px;
    line-height: 1.5;
    color: #fff;
    text-transform: uppercase;
    width: 80%;
    height: 40px;
    border-radius: 7px;
    background: #57b846;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 0 25px;
  }
  button {
    outline: none !important;
    border: none;
    background: transparent;
  }

  body {
    font-family: Arial, sans-serif;
    background-color: #f4f4f4;
    color: #333;
    margin: 0;
    padding: 0;
  }
  .container {
    width: 80%;
    margin: auto;
    overflow: hidden;
  }
  .back-button {
    display: flex;
    align-items: center;
    font-size: 1.1em;
    margin: 20px 0;
    cursor: pointer;
    color: #020101;
    text-decoration: none;
  }
  .back-button:hover {
    color: #020101;
  }
  .back-button i {
    margin-right: 8px;
    font-size: 2em;
  }
  h1 {
    text-align: center;
    padding: 20px;
  }

  .filter-bar input[type="text"],
  .filter-bar select {
    padding: 10px;
    width: 180px;
    border: 1px solid #ccc;
    border-radius: 4px;
  }
  .filter-bar button {
    padding: 10px 15px;
    border: none;
    background-color: #0656d2;
    color: #fff;
    border-radius: 4px;
    cursor: pointer;
  }
  .filter-bar button:hover {
    background-color: #003c9d;
  }
  table {
    width: 100%;
    margin: 20px 0;
    border-collapse: collapse;
  }
  table, th, td {
    border: 1px solid #ddd;
  }
  th, td {
    padding: 12px;
    text-align: left;
  }
  th {
    background-color: #0656d2;
    color: white;
  }
  tr:nth-child(even) {
    background-color: #f2f2f2;
  }
  .pagination {
    display: flex;
    justify-content: center;
    align-items: center;
    margin-top: 20px;
  }
  .pagination button {
    padding: 10px 15px;
    margin: 0 5px;
    background-color: #0656d2;
    color: #fff;
    border: none;
    border-radius: 4px;
    cursor: pointer;
  }
  .pagination button:hover {
    background-color: #003c9d;
  }
  .button-group {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin-bottom: 20px;
  }

  .filter-button {
    background: linear-gradient(135deg, #6a11cb, #2575fc);
    color: white;
    border: none;
    padding: 12px 20px;
    font-size: 16px;
    font-weight: bold;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s ease-in-out;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  }

  .filter-button:hover {
    background: linear-gradient(135deg, #2575fc, #6a11cb);
    transform: scale(1.05);
    box-shadow: 0 6px 10px rgba(0, 0, 0, 0.15);
  }

  .filter-button:active {
    transform: scale(0.95);
  }
  .container {
    width: 90%;
    margin: 0 auto;
  }

  .user-section {
    flex: 2;
    background: white;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.1);
  }

  .stats-section {
    flex: 1;
    background: white;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.1);
    text-align: center;
  }

  /* Nút chọn */
  .button-group {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin-bottom: 20px;
  }

  .filter-button {
    background: linear-gradient(135deg, #6a11cb, #2575fc);
    color: white;
    border: none;
    padding: 12px 20px;
    font-size: 14px;
    border-radius: 6px;
    cursor: pointer;
    transition: 0.3s;
  }

  .filter-button:hover {
    background: linear-gradient(135deg, #2575fc, #6a11cb);
    transform: scale(1.05);
  }

  /* Xuất Excel */
  .export-button {
    display: inline-block;
    padding: 10px 15px;
    background: #28a745;
    color: white;
    border-radius: 5px;
    text-decoration: none;
    margin-bottom: 15px;
  }

  .alert-success {
    background: #d4edda;
    color: #155724;
    padding: 10px;
    text-align: center;
    border-radius: 5px;
    margin-bottom: 10px;
  }

  /* Bảng */
  table {
    width: 100%;
    border-collapse: collapse;
  }

  table, th, td {
    border: 1px solid #ddd;
  }

  th {
    background: #1266dd;
    color: white;
    padding: 10px;
    text-align: left;
  }

  td {
    padding: 10px;
  }

  .pagination {
    display: flex;
    gap: 5px;
    list-style: none;
    padding: 0;
  }

  .pagination li a {
    display: block;
    padding: 8px 12px;
    background: #007bff;
    color: white;
    text-decoration: none;
    border-radius: 5px;
    transition: 0.3s;
  }

  .pagination li a:hover {
    background: #0056b3;
  }

  .pagination .active a {
    background: #0056b3;
  }

</style>
<body>

  <header>
    <div style="background-color: white;" class="flex border top">
      <div class="container">
        <div class="header flex">
          <div class="web icon">
            <a th:href="@{/api/home}"><img style="width: 50%; height: 50%;" src="https://res.cloudinary.com/hoaptit/image/upload/v1730187948/tro-sinh-vien2_wiuzca.png" alt=""></a>
          </div>
          <div class="right header flex">
            <div class="big-device flex">
              <div><a class="btn italic" th:href="@{/user/profile}"><h4 th:text="${username}"></h4></a></div>
              <div><a class="btn header-btn" th:href="@{/user/logout}">Đăng xuất</a></div>

            </div>

            <div class="small-device flex">
              <div><a href="@{/user/login}" type="button" style="padding: 3px;" class="fa fa-sign-in"></a></div>
              <div><a href="@{/user/register}" type="button" style="padding: 3px;" class="fa-solid fa-user-plus"></a></div>
            </div>
          </div>
        </div>

      </div>

    </div>
  </header>
  <div class="toggle">
    <i class="fas fa-bars"></i>
  </div>
  <nav>
    <div>
      <div class="container">
        <ul class="menu flex" id="menu">
          <li><a class="active" th:href="@{/api/home}">Nhà trọ,phòng trọ</a></li>
          <li><a th:href="@{/api/home/vipRoom}">Phòng nổi bật</a></li>
          <li th:if="${role == 'Admin'}"><a class="active" th:href="@{/admin/UserManagement}">Người dùng</a></li>
          <li th:if="${role == 'Admin'}"><a  th:href="@{/admin/RoomManagement}">Phòng</a></li>
          <li th:if="${role == 'Tenant'}"><a th:href="@{/user/schedule}">Lịch xem phòng</a></li>
          <li th:if="${role == 'Landlord'}"><a th:href="@{/user/appointment}">Lịch hẹn</a></li>
          <li th:if="${role == 'Landlord'}"><a th:href="@{/api/room/manage}">Quản lý phòng trọ</a></li>
          <li th:if="${role == 'Admin'}"><a th:href="@{/admin/RevenueManagement}">Doanh thu</a></li>
          <li><a th:href="@{/api/home/priceMenu}">Bảng giá</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <div class="container">
    <section>
      <div style="margin-top: 10px;" class="content">
        <div class="stats-section border" >
          <h3 style="text-align: center">Thống kê người dùng đăng ký</h3>

          <!-- Nút chọn -->
          <div class="button-group">
            <button class="filter-button" onclick="updateChart('week')">📅 Tuần</button>
            <button class="filter-button" onclick="updateChart('month')">📆 Tháng</button>
            <button class="filter-button" onclick="updateChart('year')">📊 Năm</button>
          </div>

          <!-- Biểu đồ -->
          <canvas id="userChart" width="400" height="200"></canvas>
        </div>
        <div class="user-section border">
          <h1 class="title" style="background-color: #1266dd; font-style: initial; color: white">Quản Lý Người Dùng</h1>
          <a th:href="@{/admin/printUsers}">Xuất ra Excel</a>
          <br>
          <label for="pageSize">Hiển thị:</label>
          <select id="pageSize" name="pageSize" onchange="filterByPageSize(this)">
            <option value="10" th:selected="${pageSize == '10'}">10 hàng</option>
            <option value="20" th:selected="${pageSize == '20'}">20 hàng</option>
            <option value="30" th:selected="${pageSize == '30'}">30 hàng</option>
          </select>
          <!-- Thêm thông báo thành công -->
          <div th:if="${exportSuccess == 'true'}" class="alert alert-success" style="position: fixed; top: 20px; left: 50%; transform: translateX(-50%); z-index: 9999;">
            Xuất Excel thành công!
          </div>
      <table>
    <thead>
    <tr>
      <th style="background-color: #1266dd">ID</th>
      <th style="background-color: #1266dd">Tên</th>
      <th style="background-color: #1266dd">Số điện thoại</th>
      <th style="background-color: #1266dd">Email</th>
      <th style="background-color: #1266dd">Quyền hạn</th>
    </tr>
    </thead>
    <tbody id="userTable">
    <tr th:each="user : ${users}">
      <td th:text="${user.getId()}"></td>
      <td th:text="${user.getFullname()}"></td>
      <td th:text="${user.getTel()}"></td>
      <td th:text="${user.getEmail()}"></td>
      <td th:if="${user.getRole_id() == 2}">Chủ trọ</td>
      <td th:if="${user.getRole_id() != 2}">Người dùng</td>
    </tr>
    </tbody>
  </table>
          <div class="box-footer clearfix">
            <ul class="pagination pagination-sm no-margin pull-right">
              <li th:if="${currentPage > 1}">
                <a th:href="@{'/admin/UserManagement?pageNo=' + ${currentPage - 1}}"><<</a>
              </li>
              <li th:each="i : ${#numbers.sequence(1, totalPage)}"
                  th:classappend="${currentPage == i ? 'active' : ''}">
                <a th:href="@{'/admin/UserManagement?pageSize='+${pageSize} +'&pageNo=' + ${i}}" th:text="${i}">
                </a>
              </li>
              <li th:if="${currentPage < totalPage}">
                <a th:href="@{'/admin/UserManagement?pageSize='+${pageSize} +'&pageNo=' + ${currentPage + 1}}">>>
                </a>
              </li>
            </ul>
          </div>
        </div>

        <div class="right-no-border"></div>
        <div class="right-no-border"></div>
      </div>
    </section>
  </div>
  <script>
    // Tự động ẩn thông báo thành công sau 3 giây
    setTimeout(function() {
      var successAlert = document.querySelector('.alert-success');
      if (successAlert) {
        successAlert.style.display = 'none';
      }
    }, 3000);
  </script>
</body>
<script th:inline="javascript">
  // Nhận dữ liệu từ Thymeleaf
  const weekStats = JSON.parse([[${weekStats}]]);
  const monthStats = JSON.parse([[${monthStats}]]);
  const yearStats = JSON.parse([[${yearStats}]]);

  // Nhãn cho biểu đồ
  const labels = {
    week: ["6 tuần trước", "5 tuần trước", "4 tuần trước", "3 tuần trước", "2 tuần trước", "Tuần trước", "Tuần này"],
    month: ['Tháng 1', 'Tháng 2', 'Tháng 3', 'Tháng 4', 'Tháng 5', 'Tháng 6',
      'Tháng 7', 'Tháng 8', 'Tháng 9', 'Tháng 10', 'Tháng 11', 'Tháng 12'],
    year: Object.keys(yearStats).sort((a, b) => a - b) // Sắp xếp năm tăng dần
  };

  // Chọn dữ liệu mặc định
  let currentType = "month";
  let currentData = Object.values(monthStats);
  let currentLabels = labels.month;

  // Khởi tạo biểu đồ Chart.js
  const ctx = document.getElementById('userChart').getContext('2d');
  const userChart = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: currentLabels,
      datasets: [{
        label: 'Số lượng người đăng ký',
        data: currentData,
        backgroundColor: 'rgba(75, 192, 192, 0.2)',
        borderColor: 'rgba(75, 192, 192, 1)',
        borderWidth: 1
      }]
    },
    options: {
      scales: {
        y: { beginAtZero: true }
      }
    }
  });

  // Hàm cập nhật biểu đồ khi chọn thời gian
  function updateChart(type) {
    let newData;

    if (type === 'week') {
      newData = Object.values(weekStats);
    } else if (type === 'month') {
      newData = Object.values(monthStats);
    } else { // 'year'
      newData = Object.values(yearStats);
    }

    userChart.data.labels = labels[type];
    userChart.data.datasets[0].data = newData;
    userChart.update();
  }
</script>
<script>
  function filterByPageSize(selectElement) {
    const selectedPageSize = selectElement.value;
    const baseUrl = window.location.pathname; // giữ nguyên URL hiện tại
    const url = `${baseUrl}?pageSize=${selectedPageSize}`;
    window.location.href = url;
  }
</script>
</html>
